<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shopping List - MJII Operations Hub</title>
    <meta name="description" content="Shopping list and provisioning for M/Y MJII operations." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css" />
    <style>
      .shopping-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e5e7eb;
      }

      .page-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--text);
        margin: 0;
      }

      .list-stats {
        display: flex;
        gap: 16px;
        font-size: 14px;
        color: var(--muted);
      }

      .stat-item {
        background: var(--panel-2);
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      .add-item-section {
        background: var(--panel);
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(2, 6, 23, 0.04);
      }

      .add-item-title {
        font-size: 18px;
        font-weight: 600;
        margin: 0 0 20px;
        color: var(--text);
      }

      .add-item-form {
        display: flex;
        gap: 12px;
        align-items: flex-end;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        flex: 1;
      }

      .form-label {
        font-weight: 500;
        margin-bottom: 6px;
        color: var(--text);
        font-size: 14px;
      }

      .form-input, .form-select {
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s ease;
      }

      .form-input:focus, .form-select:focus {
        outline: none;
        border-color: var(--brand);
        box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
      }

      .quantity-input {
        width: 80px;
      }

      .priority-select {
        width: 120px;
      }

      .add-item-btn {
        background: var(--brand);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease;
        white-space: nowrap;
      }

      .add-item-btn:hover {
        background: #0284c7;
      }

      .shopping-section {
        background: var(--panel);
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(2, 6, 23, 0.04);
      }

      .shopping-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .shopping-title {
        font-size: 18px;
        font-weight: 600;
        margin: 0;
        color: var(--text);
      }

      .clear-all-btn {
        background: #ef4444;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .clear-all-btn:hover {
        background: #dc2626;
      }

      .items-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .item-card {
        background: var(--panel-2);
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        padding: 16px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .item-card:hover {
        box-shadow: 0 4px 12px rgba(2, 6, 23, 0.08);
      }

      .item-card.purchased {
        opacity: 0.6;
        background: #f9fafb;
      }

      .item-checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .item-checkbox.checked {
        background: var(--brand);
        border-color: var(--brand);
        color: white;
      }

      .item-checkbox.checked::after {
        content: '‚úì';
        font-size: 12px;
        font-weight: bold;
      }

      .item-details {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .item-name {
        font-weight: 600;
        color: var(--text);
        flex: 1;
      }

      .item-name.purchased {
        text-decoration: line-through;
        color: var(--muted);
      }

      .item-quantity {
        background: #f3f4f6;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        color: var(--text);
        min-width: 40px;
        text-align: center;
      }

      .item-category {
        background: #e0f2fe;
        color: #0369a1;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .item-priority {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .item-priority.high {
        background: #fef2f2;
        color: #dc2626;
        border: 1px solid #fecaca;
      }

      .item-priority.medium {
        background: #fffbeb;
        color: #d97706;
        border: 1px solid #fed7aa;
      }

      .item-priority.low {
        background: #f0fdf4;
        color: #16a34a;
        border: 1px solid #bbf7d0;
      }

      .item-actions {
        display: flex;
        gap: 8px;
      }

      .item-btn {
        padding: 6px 10px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
      }

      .item-btn:hover {
        background: #f9fafb;
        border-color: var(--brand);
      }

      .item-btn.delete {
        background: #fef2f2;
        color: #dc2626;
        border-color: #fecaca;
      }

      .item-btn.delete:hover {
        background: #fecaca;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--muted);
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state-text {
        font-size: 16px;
        margin: 0;
      }

      .sync-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 16px;
        padding: 8px 12px;
        background: var(--panel-2);
        border-radius: 6px;
        border: 1px solid #e5e7eb;
      }

      .sync-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
        animation: pulse 2s infinite;
      }

      .sync-indicator.syncing {
        background: #f59e0b;
      }

      .sync-indicator.error {
        background: #ef4444;
        animation: none;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .sync-actions {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
      }

      .sync-btn {
        padding: 6px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
      }

      .sync-btn:hover {
        background: #f9fafb;
        border-color: var(--brand);
      }

      .sync-btn.primary {
        background: var(--brand);
        color: white;
        border-color: var(--brand);
      }

      .sync-btn.primary:hover {
        background: #0284c7;
      }

      @media (max-width: 768px) {
        .add-item-form {
          flex-direction: column;
          align-items: stretch;
        }

        .form-group {
          flex: none;
        }

        .page-header {
          flex-direction: column;
          gap: 16px;
          align-items: flex-start;
        }

        .shopping-header {
          flex-direction: column;
          gap: 12px;
          align-items: flex-start;
        }

        .item-details {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .list-stats {
          flex-wrap: wrap;
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container header-inner">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true">‚öìÔ∏è</div>
          <div class="brand-text">
            <h1 class="brand-title">M/Y MJII</h1>
            <p class="brand-subtitle">Shopping List</p>
          </div>
        </div>
        <div class="header-actions">
          <a href="../index.html" class="btn secondary">üè† MJII Home</a>
        </div>
      </div>
    </header>

    <main class="shopping-container">
      <div class="page-header">
        <h1 class="page-title">Shopping List</h1>
        <div class="list-stats">
          <div class="stat-item">
            <span id="totalItems">0</span> Total Items
          </div>
          <div class="stat-item">
            <span id="purchasedItems">0</span> Purchased
          </div>
          <div class="stat-item">
            <span id="remainingItems">0</span> Remaining
          </div>
        </div>
      </div>

      <div class="add-item-section">
        <h2 class="add-item-title">Add New Item</h2>
        <form id="addItemForm" class="add-item-form">
          <div class="form-group">
            <label class="form-label" for="itemName">Item Name</label>
            <input type="text" id="itemName" class="form-input" placeholder="e.g., Fresh vegetables" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="itemQuantity">Quantity</label>
            <input type="text" id="itemQuantity" class="form-input quantity-input" placeholder="1" value="1">
          </div>
          <div class="form-group">
            <label class="form-label" for="itemCategory">Category</label>
            <select id="itemCategory" class="form-select">
              <option value="food">Food & Beverages</option>
              <option value="cleaning">Cleaning Supplies</option>
              <option value="maintenance">Maintenance</option>
              <option value="safety">Safety Equipment</option>
              <option value="personal">Personal Items</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="itemPriority">Priority</label>
            <select id="itemPriority" class="form-select priority-select">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <button type="submit" class="add-item-btn">Add Item</button>
        </form>
      </div>

      <div class="shopping-section">
        <div class="sync-status" id="syncStatus">
          <div class="sync-indicator" id="syncIndicator"></div>
          <span id="syncText">Connecting to cloud...</span>
        </div>
        <div class="sync-actions">
          <button class="sync-btn primary" id="syncNowBtn">Sync Now</button>
          <button class="sync-btn" id="refreshBtn">Refresh</button>
        </div>
        <div class="shopping-header">
          <h2 class="shopping-title">Shopping Items</h2>
          <button class="clear-all-btn" id="clearAllBtn">Clear All</button>
        </div>
        <div class="items-list" id="itemsList">
          <div class="empty-state">
            <div class="empty-state-icon">üõí</div>
            <p class="empty-state-text">No items added yet. Add your first item above!</p>
          </div>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <small>¬© <span id="year"></span> M/Y MJII ‚Ä¢ Shopping List</small>
      </div>
    </footer>

    <script>
      // Set year in footer
      document.getElementById('year').textContent = new Date().getFullYear();

      // Shopping list management
      let items = JSON.parse(localStorage.getItem('mjii_shopping_items') || '[]');
      let isOnline = navigator.onLine;

      // Load items on page load
      loadItems();

      // Add item form submission
      document.getElementById('addItemForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const itemData = {
          id: Date.now().toString(),
          name: document.getElementById('itemName').value,
          quantity: document.getElementById('itemQuantity').value || '1',
          category: document.getElementById('itemCategory').value,
          priority: document.getElementById('itemPriority').value,
          purchased: false,
          addedBy: localStorage.getItem('mjii_device_id') || generateDeviceId(),
          createdAt: new Date().toISOString()
        };

        items.push(itemData);
        saveItems();
        loadItems();
        resetForm();
      });

      // Clear all items
      document.getElementById('clearAllBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to clear all items? This cannot be undone.')) {
          items = [];
          saveItems();
          loadItems();
        }
      });

      function loadItems() {
        const itemsList = document.getElementById('itemsList');
        
        if (items.length === 0) {
          itemsList.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üõí</div>
              <p class="empty-state-text">No items added yet. Add your first item above!</p>
            </div>
          `;
          updateStats();
          return;
        }

        // Sort items: unpurchased first, then by priority, then by name
        const sortedItems = [...items].sort((a, b) => {
          if (a.purchased !== b.purchased) {
            return a.purchased ? 1 : -1;
          }
          const priorityOrder = { high: 3, medium: 2, low: 1 };
          if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
            return priorityOrder[b.priority] - priorityOrder[a.priority];
          }
          return a.name.localeCompare(b.name);
        });

        itemsList.innerHTML = sortedItems.map(item => `
          <div class="item-card ${item.purchased ? 'purchased' : ''}" data-item-id="${item.id}">
            <div class="item-checkbox ${item.purchased ? 'checked' : ''}" onclick="toggleItemPurchased('${item.id}')"></div>
            <div class="item-details">
              <span class="item-name ${item.purchased ? 'purchased' : ''}">${escapeHtml(item.name)}</span>
              <span class="item-quantity">${escapeHtml(item.quantity)}</span>
              <span class="item-category">${getCategoryLabel(item.category)}</span>
              <span class="item-priority ${item.priority}">${item.priority}</span>
            </div>
            <div class="item-actions">
              <button class="item-btn delete" onclick="deleteItem('${item.id}')">Delete</button>
            </div>
          </div>
        `).join('');

        updateStats();
      }

      function updateStats() {
        const totalItems = items.length;
        const purchasedItems = items.filter(item => item.purchased).length;
        const remainingItems = totalItems - purchasedItems;

        document.getElementById('totalItems').textContent = totalItems;
        document.getElementById('purchasedItems').textContent = purchasedItems;
        document.getElementById('remainingItems').textContent = remainingItems;
      }

      function saveItems() {
        localStorage.setItem('mjii_shopping_items', JSON.stringify(items));
        if (isOnline) {
          setTimeout(syncToCloud, 1000);
        }
      }

      function resetForm() {
        document.getElementById('addItemForm').reset();
        document.getElementById('itemQuantity').value = '1';
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function getCategoryLabel(category) {
        const labels = {
          food: 'Food',
          cleaning: 'Cleaning',
          maintenance: 'Maintenance',
          safety: 'Safety',
          personal: 'Personal',
          other: 'Other'
        };
        return labels[category] || category;
      }

      function toggleItemPurchased(itemId) {
        const item = items.find(i => i.id === itemId);
        if (item) {
          item.purchased = !item.purchased;
          saveItems();
          loadItems();
        }
      }

      function deleteItem(itemId) {
        if (confirm('Are you sure you want to delete this item?')) {
          items = items.filter(i => i.id !== itemId);
          saveItems();
          loadItems();
        }
      }

      function generateDeviceId() {
        const id = 'device_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('mjii_device_id', id);
        return id;
      }

      // Cloud sync functions
      function updateSyncStatus(status, message) {
        const indicator = document.getElementById('syncIndicator');
        const text = document.getElementById('syncText');
        
        indicator.className = 'sync-indicator';
        if (status === 'syncing') indicator.classList.add('syncing');
        if (status === 'error') indicator.classList.add('error');
        
        text.textContent = message;
      }

      async function syncToCloud() {
        if (!isOnline) {
          updateSyncStatus('error', 'Offline - changes saved locally');
          return;
        }

        updateSyncStatus('syncing', 'Syncing to cloud...');
        
        try {
          const syncData = {
            items: items,
            lastUpdated: new Date().toISOString(),
            deviceId: localStorage.getItem('mjii_device_id') || generateDeviceId()
          };
          
          localStorage.setItem('mjii_shared_shopping', JSON.stringify(syncData));
          sessionStorage.setItem('mjii_shared_shopping', JSON.stringify(syncData));
          
          updateSyncStatus('success', 'Synced to cloud');
          setTimeout(() => updateSyncStatus('success', 'All devices synced'), 2000);
        } catch (error) {
          console.error('Cloud sync error:', error);
          updateSyncStatus('error', 'Sync failed - saved locally');
        }
      }

      async function syncFromCloud() {
        if (!isOnline) {
          updateSyncStatus('error', 'Offline - showing local data');
          return;
        }

        updateSyncStatus('syncing', 'Loading from cloud...');
        
        try {
          let sharedData = localStorage.getItem('mjii_shared_shopping');
          
          if (!sharedData) {
            sharedData = sessionStorage.getItem('mjii_shared_shopping');
          }
          
          if (sharedData) {
            const parsed = JSON.parse(sharedData);
            if (parsed.items && Array.isArray(parsed.items)) {
              items = parsed.items;
              localStorage.setItem('mjii_shopping_items', JSON.stringify(items));
              loadItems();
              updateSyncStatus('success', 'Loaded from cloud');
              return;
            }
          }
          
          updateSyncStatus('success', 'No shared data - using local');
        } catch (error) {
          console.error('Cloud load error:', error);
          updateSyncStatus('error', 'Load failed - showing local data');
        }
      }

      // Event listeners for sync buttons
      document.getElementById('syncNowBtn').addEventListener('click', syncToCloud);
      document.getElementById('refreshBtn').addEventListener('click', syncFromCloud);

      // Auto-sync on page load
      syncFromCloud();
    </script>
  </body>
</html>
